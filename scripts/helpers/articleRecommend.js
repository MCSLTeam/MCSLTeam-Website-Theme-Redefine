const articleLibrary=[],corpus=[];let flag=null;function fetchData(e,t){e.each(function(e){["post","docs"].includes(e.layout)&&(articleLibrary.push({path:e.path,title:e.title||e.seo_title||e.short_title,headimg:e.thumbnail||e.banner||e.cover||t.placeholder}),corpus.push(tokenize(e.raw)))})}function cleanData(e){const t=[",",".","?","!",":",";","、","……","~","&","@","#","，","。","？","！","：","；","·","…","～","＆","＠","＃","“","”","‘","’","〝","〞",'"',"'","＂","＇","´","＇","(",")","【","】","《","》","＜","＞","﹝","﹞","<",">","(",")","[","]","«","»","‹","›","〔","〕","〈","〉","{","}","［","］","「","」","｛","｝","〖","〗","『","』","︵","︷","︹","︿","︽","﹁","﹃","︻","︗","/","|","\\","︶","︸","︺","﹀","︾","﹂","﹄","﹄","︼","︘","／","｜","＼","_","¯","＿","￣","﹏","﹋","﹍","﹉","﹎","﹊","`","ˋ","¦","︴","¡","¿","^","ˇ","­","¨","ˊ"," ","　","%","*","-","+","=","￥","$","（","）"];e=(e=(e=e.replace(/\s/g," ")).replace(/\!\[(.*?)\]\(.*?\)/g,(e,t)=>t)).replace(/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g," ");for(const r of t)e=e.replace(new RegExp("\\"+r,"g")," ");return e=(e=e.replace(/\d+/g," ")).replace(/\s/g," ")}function tokenize(e){return require("nodejieba").cut(cleanData(e),!0).filter(e=>" "!==e&&!/^[0-9]*$/.test(e))}function cosineSimilarity(e,t){let r=0,n=0,c=0;if(e.length==t.length){for(let o=0;o<e.length;o++)r+=e[o]*t[o],n+=e[o]*e[o],c+=t[o]*t[o];return r/(Math.sqrt(n)*Math.sqrt(c))}}function createWordLibrary(e){const t={};return e.forEach(e=>{t[e]=0}),t}function calculateWordFrequency(e,t){const r=t.reduce((e,t)=>(t in e&&e[t]++,e),JSON.parse(JSON.stringify(e))),n=JSON.parse(JSON.stringify(e));for(const c of Object.keys(e))n[c]=r[c]/t.length;return n}function articleRecommendation(e){const t={},r={},n={};let c=[];for(const e of corpus)c=[...new Set(c.concat(e))];const o=createWordLibrary(c),i=JSON.parse(JSON.stringify(o));for(let e=0;e<corpus.length;e++){const r=articleLibrary[e].path,n=calculateWordFrequency(o,corpus[e]);t[r]={wordFrequency:n};for(const e of Object.keys(o))n[e]&&i[e]++}for(let e=0;e<corpus.length;e++){const r=articleLibrary[e].path;t[r].inverseDocumentFrequency=JSON.parse(JSON.stringify(o)),t[r]["wordFrequency-inverseDocumentFrequency"]=JSON.parse(JSON.stringify(o)),t[r].wordFrequencyVector=[];for(const e of Object.keys(o)){const n=Math.log(corpus.length/(i[e]+1)),c=t[r].wordFrequency[e]*n;t[r].wordFrequencyVector.push(c)}}for(let c=0;c<corpus.length;c++){const o=articleLibrary[c].path;r[o]={};for(let e=0;e<corpus.length;e++){const n=articleLibrary[e].path;r[o][n]=cosineSimilarity(t[o].wordFrequencyVector,t[n].wordFrequencyVector)}for(let e=0;e<corpus.length;e++)n[o]=Object.keys(r[o]).sort(function(e,t){return r[o][t]-r[o][e]});const i=n[o].indexOf(o);i>-1&&n[o].splice(i,1),n[o]=n[o].slice(0,e.limit);for(let e=0;e<n[o].length;e++){const t=n[o][e];n[o][e]=articleLibrary.filter(e=>e.path==t)[0]}}hexo.locals.set("recommendationSet",function(){return n})}function userInterface(e,t){let r="",n="";for(const t of e)r+=itemInterface(t);for(const r of e.slice(0,t.mobile_limit))n+=itemInterface(r);return`\n  <div class="recommended-article px-2 sm:px-6 md:px-8">\n   <div class="recommended-desktop">\n    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">\n     <i aria-hidden="true"></i><span>${t.title}</span>\n    </div>\n    <div class="recommended-article-group">${r}</div>\n   </div>\n   <div class="recommended-mobile">\n   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">\n     <i aria-hidden="true"></i><span>${t.title}</span>\n   </div>\n   <div class="recommended-article-group">${n}</div>\n   </div>\n  </div>`}function itemInterface(e){return`<a class="recommended-article-item" href="${hexo.config.root+e.path}" title="${e.title}" rel="bookmark">\n  <img src="${e.headimg}" alt="${e.title}" class="!max-w-none">\n  <span class="title">${e.title}</span>\n</a>`}hexo.extend.filter.register("template_locals",function(e){const t=hexo.theme.config.articles.recommendation;return t.enable?(flag||(flag=1,fetchData(e.site.posts,t),fetchData(e.site.pages,t),articleRecommendation(t)),e):e}),hexo.extend.helper.register("articleRecommendationGenerator",function(e){if(!e)return"";const t=hexo.theme.config.articles.recommendation;if(!t.enable)return"";for(const r of t.skip_dirs)if(new RegExp("^"+r,"g").test(e.path))return"";return userInterface(hexo.locals.get("recommendationSet")[e.path],t)});