const{version:version}=require("../../package.json"),https=require("https");function logInfo(_){hexo.log.info(`\n      +======================================================================================+\n      |                                                                                      |\n      |    _____ _   _ _____ __  __ _____   ____  _____ ____  _____ _____ ___ _   _ _____    |\n      |   |_   _| | | | ____|  \\/  | ____| |  _ \\| ____|  _ \\| ____|  ___|_ _| \\ | | ____|   |\n      |     | | | |_| |  _| | |\\/| |  _|   | |_) |  _| | | | |  _| | |_   | ||  \\| |  _|     |\n      |     | | |  _  | |___| |  | | |___  |  _ <| |___| |_| | |___|  _|  | || |\\  | |___    |\n      |     |_| |_| |_|_____|_|  |_|_____| |_| \\_\\_____|____/|_____|_|   |___|_| \\_|_____|   |\n      |                                                                                      |\n      |                            current v${version}  latest v${_.npmVersion}                             |\n      |                  https://github.com/EvanNotFound/hexo-theme-redefine                 |\n      +======================================================================================+\n                      `)}function logFailedInfo(){hexo.log.info(`\n      +======================================================================================+\n      |                                                                                      |\n      |    _____ _   _ _____ __  __ _____   ____  _____ ____  _____ _____ ___ _   _ _____    |\n      |   |_   _| | | | ____|  \\/  | ____| |  _ \\| ____|  _ \\| ____|  ___|_ _| \\ | | ____|   |\n      |     | | | |_| |  _| | |\\/| |  _|   | |_) |  _| | | | |  _| | |_   | ||  \\| |  _|     |\n      |     | | |  _  | |___| |  | | |___  |  _ <| |___| |_| | |___|  _|  | || |\\  | |___    |\n      |     |_| |_| |_|_____|_|  |_|_____| |_| \\_\\_____|____/|_____|_|   |___|_| \\_|_____|   |\n      |                                                                                      |\n      |                        current v${version}  fetch latest failed                           |\n      |                  https://github.com/EvanNotFound/hexo-theme-redefine                 |\n      +======================================================================================+\n       `)}function checkVersionAndCDNAvailability(_){_.npmVersion>version&&hexo.log.warn("[33m%s[0m",`Redefine v${version} is outdated, please update to v${_.npmVersion}!`),_.staticfileCDN?(hexo.log.info("[32m%s[0m","CDN available: StaticfileCDN"),hexo.locals.set("cdnTestStatus_staticfile",200)):(hexo.log.warn("[31m%s[0m","StaticfileCDN is unavailable yet."),hexo.locals.set("cdnTestStatus_staticfile",404)),_.bootCDN?(hexo.log.info("[32m%s[0m","CDN available: BootCDN"),hexo.locals.set("cdnTestStatus_bootcdn",200)):(hexo.log.warn("[31m%s[0m","BootCDN CDN is unavailable yet."),hexo.locals.set("cdnTestStatus_bootcdn",404))}hexo.on("ready",async()=>{const _=3e3;try{await async function(){return new Promise((e,t)=>{https.get("https://redefine-version.ohevan.com/api/info",{timeout:_},_=>{if(_.statusCode<200||_.statusCode>299)return t(new Error(`Failed to load page, status code: ${_.statusCode}`));let o="";_.on("data",_=>{o+=_}),_.on("end",()=>{try{const _=JSON.parse(o);logInfo(_),checkVersionAndCDNAvailability(_),e()}catch(_){logFailedInfo(),t(new Error(`JSON parse failed: ${_.message}`))}})}).on("error",_=>{t(_)})})}()}catch(_){hexo.log.warn(`Check latest version failed: ${_}`),hexo.locals.set("cdnTestStatus_bootcdn",404),hexo.locals.set("cdnTestStatus_staticfile",404)}});